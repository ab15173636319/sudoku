# 数独游戏 (Sudoku Game)

一个基于 Taro + Vue3 + NutUI 开发的跨平台数独游戏应用，支持微信小程序、H5、支付宝小程序等多个平台。

## 📖 项目介绍

本项目是一个功能完整的数独游戏应用，具有以下特性：

- **完整的数独游戏功能**：自动生成数独谜题、实时验证、错误提示
- **多种难度等级**：简单(30格挖空)、中等(40格挖空)、困难(48格挖空)、专家(56格挖空)
- **丰富的交互功能**：撤销、清除、重新开始、行列高亮、九宫格完成动画
- **键盘输入支持**：支持数字键盘输入（H5平台），数字键1-9输入，Backspace/Delete删除
- **游戏统计系统**：记录游戏次数、通关次数、最快通关时间、准确率
- **主题切换**：支持浅色、暗黑模式（预留接口）
- **美观的UI设计**：采用 NutUI 组件库，界面简洁美观

## 🚀 项目使用

### 环境要求

- Node.js >= 14
- npm 或 pnpm

### 安装依赖

```bash
# 使用 npm
npm install

# 或使用 pnpm（推荐）
pnpm install
```

### 开发运行

```bash
# 微信小程序
npm run dev:weapp

# H5
npm run dev:h5

# 支付宝小程序
npm run dev:alipay

# 抖音小程序
npm run dev:tt

# 其他平台...
```

### 生产构建

```bash
# 微信小程序
npm run build:weapp

# H5
npm run build:h5

# 其他平台...
```

构建产物将生成在 `dist` 目录下。

## 📦 项目依赖

### 核心依赖

- **@tarojs/taro** (4.1.9) - Taro 框架核心库，提供跨平台开发能力
- **vue** (^3.3.0) - Vue 3 框架
- **@nutui/nutui-taro** (^4.2.8) - NutUI 组件库（Taro版本）
- **@nutui/icons-vue-taro** (^0.0.9) - NutUI 图标库

### Taro 相关依赖

- **@tarojs/components** - Taro 组件库
- **@tarojs/runtime** - Taro 运行时
- **@tarojs/plugin-framework-vue3** - Vue3 框架插件
- **@tarojs/vite-runner** - Vite 构建工具

### 开发依赖

- **@tarojs/cli** (4.1.9) - Taro CLI 工具
- **typescript** (^5.1.0) - TypeScript 支持
- **vite** (^4.2.0) - 构建工具
- **sass** (^1.60.0) - CSS 预处理器
- **eslint** - 代码检查工具
- **@vitejs/plugin-vue** - Vue 插件

## 💡 项目思路

### 架构设计

项目采用标准的 Taro + Vue3 架构，主要分为以下几个部分：

```
src/
├── pages/              # 页面目录
│   ├── index/         # 首页（难度选择、设置入口）
│   ├── game/          # 游戏页面（核心游戏逻辑）
│   └── settings/      # 设置页面（已改为弹框形式）
├── utils/             # 工具函数目录
│   ├── sudoku.ts      # 数独核心逻辑（生成、验证、挖空）
│   ├── statistics.ts  # 统计数据管理
│   └── theme.ts       # 主题管理
├── components/        # 组件目录
└── assets/           # 静态资源
```

### 核心功能实现

#### 1. 数独生成算法 (`utils/sudoku.ts`)

- **完全填充算法**：使用回溯算法生成完整的数独解决方案
- **对角线填充**：首先生成对角线上的3x3格子（它们相互独立）
- **挖空机制**：根据难度等级随机挖空指定数量的格子
- **验证系统**：实时验证用户输入的正确性

```typescript
// 核心流程
generateSudoku() → 生成完整解
createPuzzle(solution, difficulty) → 根据难度挖空
validateBoard(board, solution) → 验证并标记错误
```

#### 2. 游戏状态管理 (`pages/game/game.vue`)

- **响应式状态**：使用 Vue3 Composition API 管理游戏状态
- **历史记录**：实现撤销功能（最多保存50步）
- **计时系统**：从第一次点击空格开始计时
- **完成检测**：实时检测数独是否完成

#### 3. 交互体验优化

- **视觉反馈**：
  - 选中单元格高亮
  - 选中行列高亮显示
  - 用户填写数字显示为蓝色
  - 九宫格完成时缩放动画，数字变为黑色
  
- **操作功能**：
  - 撤销：支持多步撤销
  - 清除：清除所有用户填写的数字
  - 重新开始：重置游戏状态
  - 键盘输入：支持数字键1-9输入，Backspace/Delete删除（H5平台）

#### 4. 统计数据系统 (`utils/statistics.ts`)

- **数据存储**：使用 Taro 本地存储（localStorage）
- **统计维度**：
  - 游戏次数：记录每个难度的游戏开始次数
  - 通关次数：记录完成次数
  - 最快通关时间：记录并更新最佳时间
  - 准确率：基于总输入次数和错误次数计算

```typescript
// 数据结构
{
  playCount: number,      // 游戏次数
  winCount: number,       // 通关次数
  totalErrors: number,    // 总错误次数
  totalInputs: number,    // 总输入次数
  bestTime: number | null // 最快通关时间
}
```

#### 5. 主题系统 (`utils/theme.ts`)

- **主题模式**：支持浅色、暗黑、跟随系统（预留）
- **持久化存储**：主题设置保存在本地
- **样式切换**：通过 CSS 类名实现主题切换

#### 6. 键盘事件处理 (`pages/game/game.vue`)

- **键盘监听**：在 H5 平台监听键盘事件
- **数字键输入**：1-9 数字键直接输入对应数字
- **删除键支持**：Backspace 和 Delete 键删除当前选中数字
- **事件管理**：组件挂载时添加监听，卸载时移除，避免内存泄漏

### 技术特点

1. **跨平台兼容**：基于 Taro 框架，一套代码多端运行
2. **类型安全**：全面使用 TypeScript，提高代码质量
3. **组件化开发**：使用 Vue3 Composition API，代码结构清晰
4. **状态管理**：使用响应式数据管理游戏状态
5. **性能优化**：
   - 历史记录限制在50步
   - 使用 Set 数据结构快速查找完成的九宫格
   - CSS 动画优化用户体验

### 难点与解决方案

1. **数独生成算法**：使用回溯算法确保生成有效解，填充对角线格子加速生成
2. **实时验证**：每次输入后验证整个数独板，标记错误位置
3. **九宫格完成检测**：维护完成的九宫格集合，实现动画效果
4. **跨平台兼容**：使用 Taro API 统一处理平台差异（如本地存储）
5. **键盘事件处理**：仅在浏览器环境添加键盘监听，避免小程序平台报错，使用事件委托优化性能

## 📱 功能清单

### 游戏功能
- ✅ 自动生成数独谜题
- ✅ 四种难度等级（简单/中等/困难/专家）
- ✅ 实时验证和错误提示
- ✅ 撤销功能（最多50步）
- ✅ 清除所有填写
- ✅ 重新开始
- ✅ 行列高亮提示
- ✅ 九宫格完成动画
- ✅ 游戏计时
- ✅ 完成检测
- ✅ 键盘输入支持（数字键1-9、删除键，H5平台）

### 统计功能
- ✅ 记录游戏次数
- ✅ 记录通关次数
- ✅ 记录最快通关时间
- ✅ 计算准确率
- ✅ 各难度独立统计
- ✅ 数据持久化存储

### 设置功能
- ✅ 设置弹框（底部弹出）
- ✅ 主题切换（预留接口）
- ✅ 统计数据展示
- ✅ 清除统计数据

## 🛠️ 开发规范

- 代码风格：使用 ESLint + TypeScript 规范
- 样式：使用 SCSS 预处理器
- 组件：优先使用 NutUI 组件库
- 状态管理：Vue3 Composition API
- 类型定义：全面使用 TypeScript
